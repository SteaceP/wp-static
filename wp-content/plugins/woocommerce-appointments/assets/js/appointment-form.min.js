function wca_get_querystring(t){"use strict";t=t.replace("/[*+?^$.\\[\\]{}()|\\/]/g","\\$&");t=location.search.match(new RegExp("[?&]"+t+"=([^&]+)(&|$)"));return t&&decodeURIComponent(t[1].replace(/\+/g," "))}function wca_is_valid_date(t){"use strict";var t=t.split("-"),a=parseInt(t[0],10),e=parseInt(t[1],10),t=parseInt(t[2],10),n=new Date(a,e-1,t);return a===n.getFullYear()&&e===n.getMonth()+1&&t===n.getDate()}function wca_get_cookie(t){"use strict";for(var a=t+"=",e=document.cookie.split(";"),n=0;e.length>n;n++){for(var o=e[n];" "===o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(a))return o.substring(a.length,o.length)}return null}function wca_set_cookie(t,a,e){"use strict";var n,o="";e&&((n=new Date).setTime(n.getTime()+24*e*60*60*1e3),o="; expires="+n.toUTCString()),document.cookie=t+"="+(a||"")+o+"; path=/"}jQuery(function(p){"use strict";var r=[],e=1,c={init:function(){var t=p(".wc-appointments-appointment-form");t.show().prop("disabled",!1),p(".wc-appointments-appointment-form-button").show().removeClass("disabled").prop("disabled",!0),e=t.length,t.each(function(){var t=p(this).closest("form");c.appointment_form_init(t)})},appointment_form_init:function(t){var a=t.find(".picker:eq(0)").attr("data-duration_unit"),a=(t.find(".wc-appointments-appointment-form-button").prop("disabled",!0),"day"===a?t.on("date-selected",this.calculate_costs).on("staff-selected",this.calculate_costs).on("addon-duration-changed",this.calculate_costs).on("addon-costs-changed",this.calculate_costs):"month"===a?t.on("month-selected",this.calculate_costs).on("staff-selected",this.calculate_costs).on("addon-duration-changed",this.calculate_costs).on("addon-costs-changed",this.calculate_costs):t.on("time-selected",this.calculate_costs).on("addon-costs-only-changed",this.calculate_costs),t.find(".quantity").on("change","input, select",this.calculate_costs),e<=1&&t.on("month-selected",this.update_querystring).on("date-selected",this.update_querystring).on("time-selected",this.update_querystring).on("staff-selected",this.update_querystring).on("addon-selected",this.update_querystring),t.on("updated_addons",this.selected_addon),t.find("#product-addons-total"));(a&&a.data("price_data")?a.data("price_data"):0).length&&c.selected_addon("preset",t),t.on("appointment-cost-success",this.tm_epo_integration)},selected_addon:function(t,a){var t=(a="preset"!==t?p(this).closest("form"):a).find(".single_add_to_cart_button").is(":disabled"),e=(a.find(".single_add_to_cart_button").prop("disabled",!0),a.find("#product-addons-total")),e=e&&e.data("price_data")?e.data("price_data"):0,n=a.find("#wc_appointments_field_addons_duration"),o=a.find("#wc_appointments_field_addons_cost"),r=0<parseInt(a.find(".input-text.qty").val())?parseInt(a.find(".input-text.qty").val()):1,d=0,s=0,i=!1,c=!1;e.length&&p.each(e,function(t,a){var e=0;if(a.duration_raw_pu&&0!==parseInt(a.duration_raw_pu)?e=a.duration_raw_pu:a.duration_raw&&0!==parseInt(a.duration_raw)&&(e=a.duration_raw),0!==parseInt(e))switch(a.duration_type){case"flat_time":d+=e;break;case"quantity_based":d+=e*r;break;default:d+=e}var n=0,o=a.cost_raw,i=a.cost_raw_pu;if(i&&0!==parseFloat(i.toString().replace(/,/g,"."))?n=i:o&&0!==parseFloat(o.toString().replace(/,/g,"."))&&(n=o),0!==parseFloat(n.toString().replace(/,/g,".")))switch(a.price_type){case"flat_fee":case"percentage_based":s+=parseFloat(n/r);break;default:s+=n}}),0<n.length&&(0!==d?n.val(d):n.val(0)),0<o.length&&(0!==s?o.val(s):o.val(0)),0!==d&&wc_appointment_form_params.duration_changed!==d?(wc_appointment_form_params.duration_changed=d,a.triggerHandler("addon-duration-changed",[d]),i=!0):0!==d&&wc_appointment_form_params.duration_changed===d?(wc_appointment_form_params.duration_changed=d,a.triggerHandler("addon-duration-unchanged",[d])):(0!==d||wc_appointment_form_params.duration_changed)&&0===d&&wc_appointment_form_params.duration_changed!==d?(wc_appointment_form_params.duration_changed=!1,a.triggerHandler("addon-duration-changed",[d]),i=!0):(wc_appointment_form_params.duration_changed=!1,a.triggerHandler("addon-duration-unchanged",[d])),0!==s&&wc_appointment_form_params.costs_changed!==s?(wc_appointment_form_params.costs_changed=s,a.triggerHandler("addon-costs-changed",[s]),c=!0):0!==s&&wc_appointment_form_params.costs_changed===s?(wc_appointment_form_params.costs_changed=s,a.triggerHandler("addon-costs-unchanged",[s])):(0!==s||wc_appointment_form_params.costs_changed)&&0===s&&wc_appointment_form_params.costs_changed!==s?(wc_appointment_form_params.costs_changed=!1,a.triggerHandler("addon-costs-changed",[s]),c=!0):(wc_appointment_form_params.costs_changed=!1,a.triggerHandler("addon-costs-unchanged",[s])),c&&!i?a.triggerHandler("addon-costs-only-changed",[s]):!c&&i?a.triggerHandler("addon-duration-only-changed",[d]):c&&i&&a.triggerHandler("addon-duration-and-costs-changed",[d]),c||i||t||a.find(".single_add_to_cart_button").prop("disabled",!1),a.triggerHandler("addon-selected")},calculate_costs:function(){var t=p(this).attr("name"),a=p(this).closest("form"),e=a.find("input.required_for_calculation"),n=!0,o=a.find("fieldset").find(".picker:eq(0)"),i=a.index();if(!o.data("is_range_picker_enabled")||"wc_appointments_field_duration"===t){if(p.each(e,function(t,a){p(a).val()||(n=!1)}),!n)return a.find(".wc-appointments-appointment-cost").hide(),void a.find(".wc-appointments-appointment-hook-after").hide();a.find(".wc-appointments-appointment-cost").block({message:null,overlayCSS:{background:"#fff",backgroundSize:"16px 16px",opacity:.6}}).show(),a.find(".single_add_to_cart_button").prop("disabled",!0),r[i]=p.ajax({type:"POST",url:wc_appointment_form_params.ajax_url,data:{action:"wc_appointments_calculate_costs",form:a.serialize()},success:function(t){"{"!==t.charAt(0)&&(t="{"+t.split(/{(.+)?/)[1]);t=JSON.parse(t);"ERROR"===t.result?(a.find(".wc-appointments-appointment-cost").html(t.html),a.find(".wc-appointments-appointment-cost").unblock(),a.find(".single_add_to_cart_button").prop("disabled",!0)):"SUCCESS"===t.result?(a.find(".wc-appointments-appointment-cost").html(t.html),a.find(".wc-appointments-appointment-cost").unblock(),a.find(".wc-appointments-appointment-hook-after").show(),a.find(".single_add_to_cart_button").prop("disabled",!1),a.triggerHandler("appointment-cost-success",[a,t.html])):(a.find(".wc-appointments-appointment-cost").hide(),a.find(".wc-appointments-appointment-hook-after").hide(),a.find(".single_add_to_cart_button").prop("disabled",!0))},error:function(){a.find(".wc-appointments-appointment-cost").hide(),a.find(".single_add_to_cart_button").prop("disabled",!0)},dataType:"html"})}},update_querystring:function(t){var a=p(this).closest("form");wc_appointment_form_params.is_admin||c.set_querystring_data(a,t)},set_querystring_data:function(t,a){var e,n,o,i,r,d,s;window.history&&window.history.pushState&&(n=t.find("input.appointment_date_year").val(),o=t.find("input.appointment_date_month").val(),i=t.find("input.appointment_date_day").val(),d=t.find("#wc_appointments_field_start_date"),r=t.find("input#wc_appointments_field_start_date").val(),t=t.find("#wc_appointments_field_staff"),r=!r||n||o||i?n+"-"+o+"-"+i:r,e=void 0!==d.attr("data-value")?d.attr("data-value"):"",n=n&&o&&i?r:null,o=0<d.length&&""!==d.val()?e:null,i=0<t.length&&""!==t.val()?t.val():null,r=window.location.href,d=c.replace_url_parameter("date",n,r),s=n&&s?s:n&&!s?d:r,o&&(s=c.replace_url_parameter("time",o,s)),"staff-selected"===a.type&&(s=i?c.replace_url_parameter("staff",i,s):c.remove_url_parameter("staff",s)),window.history.replaceState({date:n,time:o,staff:i},null,s))},replace_url_parameter:function(t,a,e){var n=e.match(/[a-z\d]+=[a-z\d]+/gi),n=n?n.length:0,o=e.match(new RegExp("[?&]"+t+"=([^&]+)")),o=o?o.length:0;return null===wca_get_querystring(t)?e+=(0<n&&o<2?"&":"?")+t+"="+encodeURIComponent(a):(n=new RegExp("("+t+"=)[^&]+"),e=e.replace(n,"$1"+encodeURIComponent(a))),e},remove_url_parameter:function(t,a){var e=a.split("?")[0],n=[],a=-1!==a.indexOf("?")?a.split("?")[1]:"";if(""!==a){for(var o=(n=a.split("&")).length-1;0<=o;--o)n[o].split("=")[0]===t&&n.splice(o,1);e=e+"?"+n.join("&")}return e},tm_epo_integration:function(t,a,e){var n,o;(window.hasOwnProperty("tm_epo_js")||window.hasOwnProperty("TMEPOJS"))&&(n=a.find(".tc-totals-form"),o=a.find(".tc-epo-totals"),n&&o&&(e=parseFloat(p.epoAPI.util.unformat(p("<div>"+e+"</div>").find(".amount").text())),o.data("price",e),n.find(".cpf-product-price").val(e),a.trigger({type:"tm-epo-update"})))}};c.init()});