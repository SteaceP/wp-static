jQuery(function(c){"use strict";var p={init:function(){var t=c(".wc-appointments-appointment-form");t.each(function(){var t=c(this).closest("form"),n=t.find(".picker:eq(0)");t.on("addon-duration-changed",function(t,e){var i=parseInt(n.attr("data-appointment_duration"),10),a=parseInt(e,10),i=parseInt(i+a,10);n.data("combined_duration",i),n.data("addon_duration",e),p.show_available_time_slots(this)}),p.time_picker_init(t)}),c("body").on("change","#wc_appointments_field_timezone",function(){p.show_available_time_slots(this)}),t.parents("form").on("date-selected",function(){p.show_available_time_slots(this)}),c("body").on("change","#wc_appointments_field_staff",function(){p.hide_time_slots(this)})},time_picker_init:function(e){e.find(".slot-picker").on("click","a",function(t){t.preventDefault();t=c(this).parent().data("slot");p.set_selected_time(e,t)})},set_selected_time:function(t,e){var i=t.find(".wc-appointments-appointment-form-button"),a=t.find(".slot-picker");if(i.prop("disabled",!0),undefined!==e){var n,i=a.find('[data-slot="'+e+'"]'),d=i.find("a").data("value");if(undefined!==i.data("slot"))return(n=t.find(".slot-picker").parent("div").find("input")).val(d),n.attr("data-value",e),t.triggerHandler("time-selected"),a.find("li").removeClass("selected"),i.addClass("selected"),"selected"}},unset_selected_time:function(t){var e=t.find(".wc-appointments-appointment-form-button"),t=t.find(".slot-picker");e.prop("disabled",!0),t.find("li").removeClass("selected")},show_available_time_slots:function(t){var i=c(t).closest("form"),e=i.find(".picker:eq(0)"),a=i.find(".slot-picker"),n=i.find("fieldset"),d=parseInt(n.find("input.appointment_date_year").val(),10),s=parseInt(n.find("input.appointment_date_month").val(),10),n=parseInt(n.find("input.appointment_date_day").val(),10),o=a.find(".selected").data("slot"),l=e.attr("data-is_autoselect"),e=e.data("addon_duration")?e.data("addon_duration"):0,r=0;"wc_appointments_field_timezone"===c(t).attr("name")&&(r=1),d&&s&&n&&(a.closest("div").find("input").val("").trigger("change"),a.closest("div").block({message:null,overlayCSS:{background:"#fff",backgroundSize:"16px 16px",opacity:.6}}).show(),c.ajax({type:"POST",url:wc_appointment_form_params.ajax_url,data:{action:"wc_appointments_get_slots",form:i.serialize(),duration:e},success:function(t){var e;a.html(t),a.closest("div").unblock(),r?p.unset_selected_time(i):(t=p.set_selected_time(i,o),null!==wca_get_querystring("time")&&undefined===t?0<(e=a.find('li.slot[data-slot="'+wca_get_querystring("time")+'"]').not(".slot_empty")).length?(i.triggerHandler("selected-time-unavailable",e),e.find("a").trigger("click")):p.autoselect_first_available_time(i):l&&undefined===t&&p.autoselect_first_available_time(i))},dataType:"html"}))},autoselect_first_available_time:function(t){var e=t.find(".picker:eq(0)"),i=t.find(".slot-picker"),a=e.find("td.ui-datepicker-current-day").not(".ui-state-disabled"),i=i.find('li.slot:not(".slot_empty"):first'),e=e.attr("data-is_autoselect");0<i.length&&i.has("a")?(i=i.data("slot"),p.set_selected_time(t,i)):e&&a.nextAll("td:not(.ui-state-disabled)").add(a.closest("tr").nextAll().find("td")).slice(0,1).trigger("click")},hide_time_slots:function(t){var t=c(t).closest("form"),e=t.find(".slot-picker"),t=t.find("fieldset"),i=parseInt(t.find("input.appointment_date_year").val(),10),a=parseInt(t.find("input.appointment_date_month").val(),10),t=parseInt(t.find("input.appointment_date_day").val(),10);i&&a&&t&&e.hide()}};p.init()});